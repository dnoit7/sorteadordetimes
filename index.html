<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PeladaMix</title>

<!-- TAGS PARA COMPARTILHAMENTO -->
<meta property="og:title" content="‚öΩ PeladaMix ‚öΩ">
<meta property="og:description" content="Monte times equilibrados de forma r√°pida e autom√°tica!">
<meta property="og:image" content="logopeladamix.png">
<meta property="og:type" content="website">

<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        margin: 0;
        padding: 0;
    }

    /* LOGO RESPONSIVA */
    .logo-container {
        text-align: center;
        margin: 10px 0 5px 0;
    }

    .logo-container img {
        width: 55%;
        max-width: 220px;
        height: auto;
    }

    h2 {
        text-align: center;
        margin-bottom: 10px;
        margin-top: 5px;
        font-weight: bold;
    }

    .container {
        width: 90%;
        max-width: 800px;
        background: white;
        padding: 20px;
        margin: auto;
        margin-top: 5px;
        border-radius: 12px;
        box-shadow: 0 0 12px rgba(0,0,0,0.08);
    }

    /* Importar lista campo */
    #importField {
        width: 100%;
        height: 120px;
        padding: 10px;
        font-size: 15px;
        border-radius: 8px;
        border: 1px solid #ccc;
        resize: none;
        margin-bottom: 10px;
    }

    /* Layout dos jogadores */
    .row {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 10px;
    }

    .row input[type="text"] {
        flex: 1;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 6px;
    }

    .row select {
        width: 70px;
        padding: 8px;
        border-radius: 6px;
        border: 1px solid #ccc;
    }

    .checkbox {
        transform: scale(1.3);
    }

    .delete-btn {
        background: transparent;
        border: none;
        cursor: pointer;
        font-size: 26px;
        margin-left: 5px;
    }

    /* BOT√ïES PERSONALIZADOS */
    button {
        padding: 12px;
        border: none;
        border-radius: 6px;
        color: white;
        cursor: pointer;
        font-size: 17px;
        width: 100%;
        margin-bottom: 10px;
    }

    #importarLista {
        background-color: #151419;
    }

    #limparTudo {
        background-color: #f56e0f;
    }

    #sortear {
        background-color: #008000;
    }

    #copiar {
        background-color: #25D366;
    }

    /* Novo: Cor vermelha para o bot√£o "Adicionar Jogador" */
    #addPlayerBtn {
        background-color: #FF0000; /* Vermelho */
    }

    /* Novo: Estilo para o select de n√∫mero de times */
    #numTimesSelect {
        width: 100%;
        padding: 8px;
        border-radius: 6px;
        border: 1px solid #ccc;
        margin-bottom: 10px;
        font-size: 16px;
    }
</style>
</head>
<body>

<!-- LOGO -->
<div class="logo-container">
    <img src="logopeladamix.png" alt="Logo PeladaMix">
</div>

<div class="container">

    <!-- CAMPO PARA COLAR LISTA (RESTAURADO!) -->
    <h2>1) Importar Lista</h2>

    <textarea id="importField" placeholder="Adicione aqui o nome dos jogadores ou cole a lista do whatsapp!"></textarea>

    <button id="importarLista" onclick="importList()">Importar Lista</button>

    <br>

    <h2>2) Jogadores</h2>

    <div id="playersList"></div>

    <!-- Novo: ID adicionado ao bot√£o para estiliza√ß√£o -->
    <button id="addPlayerBtn" onclick="addPlayer()">Adicionar Jogador</button>

    <br><br>

    <!-- Novo: Select para escolher n√∫mero de times -->
    <label for="numTimesSelect">N√∫mero de Times:</label>
    <select id="numTimesSelect">
        <option value="1">1 Time</option>
        <option value="2" selected>2 Times</option> <!-- Padr√£o: 2 times -->
        <option value="3">3 Times</option>
        <option value="4">4 Times</option>
        <option value="5">5 Times</option>
    </select>

    <button id="limparTudo" onclick="clearAll()">Limpar Tudo</button>
    <button id="sortear" onclick="sortTeams()">Sortear Times</button>

    <br><br>

    <h2>Times Gerados</h2>
    <div id="teamsOutput"></div>
    
    <button id="copiar" onclick="copyWhatsApp()">Copiar p/ WhatsApp</button>

</div>

<script>
let playerCount = 0;

// Add a new player row
function addPlayer(name = "", checked = true, level = "A") {
    // Check for duplicates
    const existingNames = Array.from(document.querySelectorAll("#playersList input[type='text']")).map(input => input.value.trim().toLowerCase());
    if (name && existingNames.includes(name.toLowerCase())) {
        alert("Jogador j√° adicionado!");
        return;
    }

    playerCount++;
    const list = document.getElementById("playersList");

    const row = document.createElement("div");
    row.className = "row";
    row.id = "player" + playerCount;

    row.innerHTML = `
        <input type="checkbox" class="checkbox" ${checked ? "checked" : ""} aria-label="Incluir jogador">
        <input type="text" placeholder="Nome" value="${name}" aria-label="Nome do jogador">
        <select aria-label="N√≠vel do jogador">
            <option value="A" ${level === "A" ? "selected" : ""}>A</option>
            <option value="B" ${level === "B" ? "selected" : ""}>B</option>
            <option value="C" ${level === "C" ? "selected" : ""}>C</option>
            <option value="D" ${level === "D" ? "selected" : ""}>D</option>
        </select>
        <button class="delete-btn" onclick="removePlayer('player${playerCount}')" aria-label="Remover jogador">üóëÔ∏è</button>
    `;

    list.appendChild(row);
}

// Remove a player row
function removePlayer(id) {
    document.getElementById(id).remove();
}

// Import list from textarea, cleaning up WhatsApp-style input
function importList() {
    const text = document.getElementById("importField").value.trim();
    if (!text) {
        alert("Cole a lista no campo acima!");
        return;
    }

    // Split by lines and clean: extract names, remove timestamps, numbers, emojis, and special chars
    const lines = text.split("\n").map(line => {
        // Remove timestamp if present
        line = line.replace(/^\$\d{1,2}\/\d{1,2}\/\d{4}, \d{1,2}:\d{2}:\d{2}\$ /, "");
        
        // If there's a ":", extract only the name before it (e.g., "Jo√£o: Oi" -> "Jo√£o")
        if (line.includes(":")) {
            line = line.split(":")[0].trim();
        }
        
        // Remove numbers
        line = line.replace(/\d+/g, "");
        
        // Remove emojis and special characters (keep letters, spaces, and accents)
        line = line.replace(/[^\w\s√Ä-√ø]/g, "").trim();
        
        return line;
    }).filter(name => name && name.length > 0); // Filter out empty lines

    lines.forEach(name => {
        if (name) addPlayer(name);
    });

    document.getElementById("importField").value = "";
}

// Clear all data
function clearAll() {
    if (confirm("Tem certeza que deseja limpar tudo?")) {
        document.getElementById("playersList").innerHTML = "";
        document.getElementById("teamsOutput").innerHTML = "";
        document.getElementById("importField").value = "";
        playerCount = 0;
    }
}

// Sort and balance teams by level
function sortTeams() {
    const players = [];

    document.querySelectorAll("#playersList .row").forEach(row => {
        const checkbox = row.querySelector("input[type='checkbox']").checked;
        const name = row.querySelector("input[type='text']").value.trim();
        const level = row.querySelector("select").value;

        if (checkbox && name) {
            players.push({ name, level, levelValue: "ABCD".indexOf(level) }); // Assign numeric value for sorting
        }
    });

    if (players.length < 2) {
        alert("Adicione ao menos 2 jogadores!");
        return;
    }

    const numTimes = parseInt(document.getElementById("numTimesSelect").value);
    if (numTimes > players.length) {
        alert("N√∫mero de times n√£o pode ser maior que o n√∫mero de jogadores!");
        return;
    }

    // Sort by level for balancing
    players.sort((a, b) => a.levelValue - b.levelValue);

    // Distribute into teams (aim for balance)
    const teams = Array.from({ length: numTimes }, () => []);
    players.forEach((player, index) => {
        const teamIndex = index % numTimes;
        teams[teamIndex].push(player);
    });

    // Display teams (removido o n√≠vel dos jogadores)
    let output = "<h3>Times Equilibrados:</h3>";
    teams.forEach((team, index) => {
        output += `<br><strong>Time ${index + 1}:</strong><br>`;
        team.forEach(p => output += `‚Ä¢ ${p.name}<br>`);  // Alterado: removido (${p.level})
    });

    document.getElementById("teamsOutput").innerHTML = output;
}

// Copy teams to clipboard for WhatsApp
function copyWhatsApp() {
    const outputElement = document.getElementById("teamsOutput");
    const output = outputElement.innerText || outputElement.textContent; // Compatibilidade com navegadores antigos
    if (!output || output.trim() === "") {
        alert("Gere os times primeiro!");
        return;
    }

    // Tenta usar a API moderna de clipboard
    if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(output).then(() => {
            alert("Times copiados para o WhatsApp! Cole no chat.");
        }).catch(err => {
            console.error("Erro na API de clipboard:", err);
            fallbackCopy(output);
        });
    } else {
        // Fallback para navegadores antigos
        fallbackCopy(output);
    }
}

// Fun√ß√£o de fallback para copiar
function fallbackCopy(text) {
    const textArea = document.createElement("textarea");
    textArea.value = text;
    textArea.style.position = "fixed"; // Fora da tela
    textArea.style.left = "-999999px";
    textArea.style.top = "-999999px";
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    
    try {
        const successful = document.execCommand('copy');
        if (successful) {
            alert("Times copiados para o WhatsApp! Cole no chat.");
        } else {
            throw new Error("ExecCommand falhou");
        }
    } catch (err) {
        console.error("Erro no fallback:", err);
        alert("N√£o foi poss√≠vel copiar automaticamente. Selecione e copie o texto abaixo manualmente:\n\n" + text);
    }
    
    document.body.removeChild(textArea);
}
</script>

</body>
</html>
